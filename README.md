# EduChain + Claude Desktop MCP Integration

## Overview
This project integrates EduChain, an educational content generation engine, with Claude Desktop via a custom Flask MCP (Model-Connected Plugin) server. It enables you to generate lesson plans, MCQs, and flashcards using Google Gemini as the LLM backend, and access these tools directly from Claude Desktop.

## Workflow & Project Architecture

### 1. High-Level Workflow
- **User Interaction:**
  - The user interacts with Claude Desktop and issues a prompt (e.g., "Generate a lesson plan for algebra").
- **Tool Trigger:**
  - Claude Desktop, using the custom `claude_desktop_config.json`, recognizes the prompt as one that should invoke a local tool (LessonPlan, GenerateMCQs, or Flashcards).
- **API Request:**
  - Claude Desktop sends a POST request to the corresponding endpoint on the local Flask MCP server (e.g., `/lesson-plan`).
- **Content Generation:**
  - The Flask server receives the request and uses EduChain's `ContentEngine` to generate the requested content (lesson plan, MCQs, or flashcards), leveraging Google Gemini as the LLM backend.
- **Response:**
  - The generated content is returned as a structured JSON response, including a unique marker (`"mcp_marker": "Generated by EduChain MCP"`) for verification.
- **Display:**
  - Claude Desktop displays the result to the user, either as formatted content or as raw JSON (if requested).

### 2. Component Interaction Diagram

```
User (Claude Desktop)
    |
    | 1. Prompt (e.g., "Generate a lesson plan for algebra")
    v
Claude Desktop MCP Tool
    |
    | 2. POST /lesson-plan (or /generate-mcqs, /flashcards)
    v
Flask MCP Server (server.py)
    |
    | 3. Calls EduChain ContentEngine (with Gemini LLM)
    v
EduChain Engine
    |
    | 4. Generates content
    v
Flask MCP Server
    |
    | 5. Returns JSON response (with mcp_marker)
    v
Claude Desktop
    |
    | 6. Displays result to user
    v
User
```

### 3. Building the Project: Step-by-Step

1. **EduChain Setup:**
   - Cloned the EduChain repository and installed it in editable mode.
   - Fixed installation issues (e.g., Unicode errors) by updating `setup.py`.
   - Ensured all dependencies were installed, including `langchain-google-genai` for Gemini support.

2. **Flask MCP Server:**
   - Created `server.py` to expose endpoints for lesson plan, MCQ, and flashcard generation.
   - Integrated EduChain's `ContentEngine` and configured it to use Gemini as the LLM backend.
   - Added `.env` support for API key management.
   - Implemented robust error handling and logging for debugging.
   - Added a unique marker to responses for easy verification.

3. **Claude Desktop Integration:**
   - Created a custom `claude_desktop_config.json` with tool definitions and endpoints.
   - Placed the config file in `%APPDATA%/Claude/` and ensured it was not empty.
   - Restarted Claude Desktop to load the new configuration.

4. **Testing & Validation:**
   - Tested endpoints directly using PowerShell and curl to ensure correct responses and marker presence.
   - Verified Claude Desktop was using the custom tools by checking for the marker in responses and monitoring server logs.
   - Troubleshot common issues (config placement, encoding, API keys, port conflicts, etc.).

5. **Enhancements & Customization:**
   - Provided guidance for adding new features (difficulty, format, grouping, etc.) to the generation logic.
   - Explained how to update prompt templates and endpoints for advanced customization.

### 1a. (Alternative) Install EduChain from Local Path
If you have the EduChain source in this project (as a folder), you can install it directly using:
```
pip install educhain @ file:///ABSOLUTE_PATH_TO_EDUCHAIN
```
Replace `ABSOLUTE_PATH_TO_EDUCHAIN` with the full path to your `educhain` directory.

Or, for editable development mode:
```
pip install -e ./educhain
```

You can also uncomment the relevant line in `requirements.txt` for local installs.

---

## Features
- **Lesson Plan Generation**: Create detailed, customizable lesson plans for any subject.
- **MCQ Generation**: Generate multiple-choice questions for any topic, with options for quantity and (optionally) difficulty.
- **Flashcard Generation**: Produce high-quality flashcards for study and revision.
- **Claude Desktop Integration**: Use your custom tools directly from Claude Desktop via MCP.

---

## Prerequisites
- **Python 3.8+**
- **pip** (Python package manager)
- **Claude Desktop** (installed on your system)
- **Google Gemini API Key** (for LLM backend)

---

## Setup Instructions

### 1. Clone and Install EduChain
```
git clone <educhain-repo-url>
cd educhain
pip install -e .
```
- If you encounter a Unicode error during install, ensure `encoding="utf-8"` is set in `setup.py`.

### 2. Install Project Dependencies
```
pip install flask python-dotenv langchain-google-genai
```

### 3. Configure Environment Variables
- Create a `.env` file in the project root:
  ```
  GEMINI_API_KEY=your_gemini_api_key_here
  ```

### 4. Set Up the Flask MCP Server
- The main server file is `server.py` in the project root.
- Start the server:
  ```
  python server.py
  ```
- The server will run at `http://localhost:5001/`

### 5. Configure Claude Desktop
- Create or update `%APPDATA%/Claude/claude_desktop_config.json` with:
  ```json
  {
    "tools": [
      {
        "name": "GenerateMCQs",
        "endpoint": "http://localhost:5001/generate-mcqs",
        "method": "POST",
        "description": "Generates multiple-choice questions for a given topic."
      },
      {
        "name": "LessonPlan",
        "endpoint": "http://localhost:5001/lesson-plan",
        "method": "POST",
        "description": "Returns a lesson plan for a subject."
      },
      {
        "name": "Flashcards",
        "endpoint": "http://localhost:5001/flashcards",
        "method": "POST",
        "description": "Returns flashcards for a given topic."
      }
    ]
  }
  ```
- **Important:** The file must be named `claude_desktop_config.json` and placed in `%APPDATA%/Claude/`.
- Restart Claude Desktop after updating the config.

---

## Usage
- Open Claude Desktop and use prompts like:
  - "Generate a lesson plan for algebra."
  - "Create 10 MCQs about photosynthesis."
  - "Make flashcards for Python data types."
- The server will process the request and return structured responses.
- For lesson plans, look for the `"mcp_marker": "Generated by EduChain MCP"` in the raw response to confirm your tool is being used.

---

## Troubleshooting & Common Issues

### 1. **Claude Desktop Not Using Your Tool**
- Ensure `claude_desktop_config.json` is in the correct directory and not empty.
- Restart Claude Desktop after any config changes.
- Check your Flask server logs for incoming requests.
- Add a unique marker (like `"mcp_marker"`) to your server responses for verification.

### 2. **Unicode or Encoding Errors**
- Edit `setup.py` in EduChain to use `encoding="utf-8"` when reading files.

### 3. **API Key Not Loaded**
- Make sure `.env` is in the project root and contains the correct key.
- Use `python-dotenv` to load environment variables.

### 4. **Port Conflicts**
- If port 5001 is in use, change the port in `server.py` and update your config accordingly.

### 5. **No Response or Errors from Endpoints**
- Test endpoints directly using `curl` or PowerShell:
  ```
  curl -X POST http://localhost:5001/lesson-plan -H "Content-Type: application/json" -d '{"subject": "algebra"}'
  ```
- Check for errors in the server output and logs.

### 6. **Claude Desktop Shows Only 'OK' or No JSON**
- Some tools may only return a confirmation. For full JSON, ensure your endpoint returns the complete response and not just a status.

### 7. **Sample Output**
- `sample_output.json` is for reference only. Update it after making changes to your generation logic if you want your sample to match the new output.

---

## Advanced Customization
- You can enhance the generation logic by adding parameters (difficulty, format, etc.) to your endpoints and updating the EduChain engine and prompt templates.
- For more advanced features, see the suggestions in this README or ask for step-by-step guidance.

---

## Support
If you encounter issues not covered here, check your server logs, review your config files, and ensure all dependencies are installed. For further help, consult the EduChain documentation or reach out to the project maintainer.

---

## Citations
- EduChain library: https://github.com/satvik314/educhain
- Claude Desktop: https://www.anthropic.com/claude
- Google Gemini API: https://ai.google.dev/
- ChatGPT (for assistance): https://chat.openai.com/ 